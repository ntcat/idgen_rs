# ğŸ¦œ idgen_rs

## ä»‹ç»
å†™ golang çš„é‚£æ®µæ—¶é—´ä¸€ç›´ç”¨ [idgen](https://github.com/yitter/idgenerator) ,å®ƒå¾ˆå¥½çš„æ»¡è¶³äº†ï¼Œæˆ‘å¯¹ snowfalke ç®—æ³• idçš„è¦æ±‚ï¼š
1. å…¨å±€å”¯ä¸€ï¼Œä½¿ç”¨ worker_id å¯ä»¥å®ç°åˆ†å¸ƒå¼å”¯ä¸€ã€‚
2. æ—¶é—´æœ‰åºï¼Œç”šè‡³æˆ‘å¯ä»¥ä» idä¸­æŠ½å–æ—¶ç”Ÿæˆ id çš„æ—¶é—´ï¼Œè¿™ä¸ªå¯¹æˆ‘å¾ˆé‡è¦ã€‚
3. å•è°ƒé€’å¢ï¼Œå…¨æ•°å­—ï¼Œint64,ä¸éœ€è¦ä¸ºå­˜å‚¨å­—ç¬¦ä¸²æŸå¤±æ€§èƒ½ã€‚ 

å½“æˆ‘å°†ç¼–ç¨‹æ–¹å‘å…¨é¢è½¬å‘ rust æ—¶ï¼Œè‡ªç„¶æˆ‘è¿˜æ˜¯ç”¨ idgen.ä½†æ˜¯æˆ‘å‘ç°ä½œè€…æ¯”è¾ƒæ‡’ï¼Œç”¨çš„æ˜¯ rustè°ƒç”¨C åº“ã€‚ä¸æ˜¯çº¯ç²¹çš„ rustç‰ˆæœ¬ã€‚
æˆ‘å°è¯•åœ¨ linux ç¯å¢ƒä¸‹ç¼–è¯‘ï¼Œè™½ç„¶éº»çƒ¦ï¼Œä½†æ˜¯è¿˜æ˜¯æˆåŠŸäº†ã€‚ä½†æ˜¯åœ¨ mac ç¯å¢ƒä¸‹ç¼–è¯‘å¤±è´¥ï¼Œæˆ‘å¤±å»ä½¿ç”¨å®ƒçš„è€å¿ƒã€‚å†³å®šè‡ªå·±å†™ä¸€ä¸ªçº¯çº¯çš„ rust ç‰ˆæœ¬ã€‚
å½“ç„¶å®ƒæ˜¯åŸºäº idgen_go,ä»¥ä¿è¯è¿™ä¸ª idç”Ÿæˆæ–¹å¼çš„å…¼å®¹æ€§ã€‚

idgen_rsï¼ŒåŸºäº snowflake ç®—æ³•å®ç°çš„ï¼Œå¹¶ä¸”å¢åŠ äº†ä¸€äº›åŠŸèƒ½ï¼š
1. æ”¯æŒå¤šç§è®¡ç®—æ–¹æ³•ï¼ŒåŒ…æ‹¬ä¼ ç»Ÿç®—æ³•å’Œæ¼‚ç§»ç®—æ³•
2. æ”¯æŒè‡ªå®šä¹‰æœºå™¨ç ä½é•¿å’Œåºåˆ—æ•°ä½é•¿
3. æ”¯æŒè‡ªå®šä¹‰æœ€å¤§åºåˆ—æ•°å’Œæœ€å°åºåˆ—æ•°
4. æ”¯æŒè‡ªå®šä¹‰æœ€å¤§æ¼‚ç§»æ¬¡æ•°
5. æ”¯æŒè‡ªå®šä¹‰åŸºç¡€æ—¶é—´

git clone https://github.com/ntcat/idgen_rs

```
fn main() {
    // é›ªèŠ±ç®—æ³•åˆ›å»º IdGeneratorOptions å¯¹è±¡ï¼Œå¯åœ¨æ„é€ å‡½æ•°ä¸­è¾“å…¥ WorkerIdï¼š
    let mut options = IdGeneratorOptions::new(1); // 1 æ˜¯ worker id
    options.worker_id_bit_length = 10; // é»˜è®¤å€¼6ï¼Œé™å®š WorkerId æœ€å¤§å€¼ä¸º2^6-1ï¼Œå³é»˜è®¤æœ€å¤šæ”¯æŒ64ä¸ªèŠ‚ç‚¹ã€‚
    options.seq_bit_length = 6; // é»˜è®¤å€¼6ï¼Œé™åˆ¶æ¯æ¯«ç§’ç”Ÿæˆçš„IDä¸ªæ•°ã€‚è‹¥ç”Ÿæˆé€Ÿåº¦è¶…è¿‡5ä¸‡ä¸ª/ç§’ï¼Œå»ºè®®åŠ å¤§ SeqBitLength åˆ° 10ã€‚
    let base_time: DateTime<Utc> = Utc.with_ymd_and_hms(2023, 3, 13, 3, 3, 3)
        .single()
        .expect("Failed to create DateTime<Utc>");
    options.base_time = base_time.timestamp_millis(); 

    // ä¿å­˜å‚æ•°ï¼ˆåŠ¡å¿…è°ƒç”¨ï¼Œå¦åˆ™å‚æ•°è®¾ç½®ä¸ç”Ÿæ•ˆï¼‰ï¼š
    yit_id_helper::set_id_generator(options);
    // åˆå§‹åŒ–åï¼Œåœ¨ä»»ä½•éœ€è¦ç”ŸæˆIDçš„åœ°æ–¹ï¼Œè°ƒç”¨ä»¥ä¸‹æ–¹æ³•ï¼š
    let new_id = yit_id_helper::next_id();
    println!("new_id: {}", new_id);

    let time = yit_id_helper::extract_time(new_id);
    let datetime: DateTime<Local> = time.into(); 
    println!("time: {}", datetime.format("%Y-%m-%d %H:%M:%S"));
}

//å‚è€ƒèµ„æ–™ï¼š

 pub struct IdGeneratorOptions {
    pub method: u16,                // é›ªèŠ±è®¡ç®—æ–¹æ³•,ï¼ˆ1-æ¼‚ç§»ç®—æ³•|2-ä¼ ç»Ÿç®—æ³•ï¼‰ï¼Œé»˜è®¤1
    pub base_time: i64,             // åŸºç¡€æ—¶é—´ï¼ˆmså•ä½ï¼‰ï¼Œä¸èƒ½è¶…è¿‡å½“å‰ç³»ç»Ÿæ—¶é—´
    pub worker_id: u16,             // æœºå™¨ç ï¼Œå¿…é¡»ç”±å¤–éƒ¨è®¾å®šï¼Œæœ€å¤§å€¼ 2^WorkerIdBitLength-1
    pub worker_id_bit_length: u8,   // æœºå™¨ç ä½é•¿ï¼Œé»˜è®¤å€¼6ï¼Œå–å€¼èŒƒå›´ [1, 15]ï¼ˆè¦æ±‚ï¼šåºåˆ—æ•°ä½é•¿+æœºå™¨ç ä½é•¿ä¸è¶…è¿‡22ï¼‰
    pub seq_bit_length: u8,         // åºåˆ—æ•°ä½é•¿ï¼Œé»˜è®¤å€¼6ï¼Œå–å€¼èŒƒå›´ [3, 21]ï¼ˆè¦æ±‚ï¼šåºåˆ—æ•°ä½é•¿+æœºå™¨ç ä½é•¿ä¸è¶…è¿‡22ï¼‰
    pub max_seq_number: u32,        // æœ€å¤§åºåˆ—æ•°ï¼ˆå«ï¼‰ï¼Œè®¾ç½®èŒƒå›´ [MinSeqNumber, 2^SeqBitLength-1]ï¼Œé»˜è®¤å€¼0ï¼Œè¡¨ç¤ºæœ€å¤§åºåˆ—æ•°å–æœ€å¤§å€¼ï¼ˆ2^SeqBitLength-1]ï¼‰
    pub min_seq_number: u32,        // æœ€å°åºåˆ—æ•°ï¼ˆå«ï¼‰ï¼Œé»˜è®¤å€¼5ï¼Œå–å€¼èŒƒå›´ [5, MaxSeqNumber]ï¼Œæ¯æ¯«ç§’çš„å‰5ä¸ªåºåˆ—æ•°å¯¹åº”ç¼–å·0-4æ˜¯ä¿ç•™ä½ï¼Œå…¶ä¸­1-4æ˜¯æ—¶é—´å›æ‹¨ç›¸åº”é¢„ç•™ä½ï¼Œ0æ˜¯æ‰‹å·¥æ–°å€¼é¢„ç•™ä½
    pub top_over_cost_count: u32,   // æœ€å¤§æ¼‚ç§»æ¬¡æ•°ï¼ˆå«ï¼‰ï¼Œé»˜è®¤2000ï¼Œæ¨èèŒƒå›´500-10000ï¼ˆä¸è®¡ç®—èƒ½åŠ›æœ‰å…³ï¼‰
}

```